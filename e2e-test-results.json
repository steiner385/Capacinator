🚀 Starting E2E global setup...
🗄️ Initializing E2E database...
🧪 Initializing E2E test database...
🔧 Running E2E database migrations...
Creating baseline database schema...
✅ Baseline database schema created successfully
Fixing primary role foreign key constraint...
✅ Fixed primary role foreign key constraint
Creating missing database views...
✅ Created missing database views
Adding person_utilization_view and project_demands_view...
✅ Added person_utilization_view and project_demands_view
Fixing project_demands_view with correct join conditions...
✅ Fixed project_demands_view with correct join conditions
Fixing database views...
✅ Fixed database views
Adding project_health_view for gaps analysis...
✅ Added project_health_view for gaps analysis
Fixing project_health_view with correct health_status column...
✅ Fixed project_health_view with correct health_status column
Improving project_demands_view with hour calculations...
✅ Improved project_demands_view with hour calculations and project type info
Fixing project_demands_view missing columns...
✅ Fixed project_demands_view with missing phase_id and renamed estimated_hours to demand_hours
Creating project_phase_dependencies table...
✅ Created project_phase_dependencies table with constraints and indexes
🔧 Fixing missing IDs in database records...
Found 0 assignments without IDs
Found 0 availability overrides without IDs
✅ Fixed missing IDs
🌱 Seeding E2E test data...
🌱 Seeding E2E test data...
✅ E2E test data seeded successfully
✅ E2E database initialized successfully
🚀 Starting development server for E2E tests...
✅ Server started successfully
⏳ Waiting for server at http://localhost:3120...
❌ E2E global setup failed: Error: Server failed to start within 60 seconds
    at waitForServer (file:///home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:195:9)
    at globalSetup (file:///home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:34:7)
    at Object.setup (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/tasks.js:173:27)
    at taskLoop (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:62:11)
    at TaskRunner.runDeferCleanup (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:78:5)
    at TaskRunner.run (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:42:33)
    at runTasks (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/tasks.js:79:18)
    at runAllTestsWithConfig (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/testRunner.js:392:18)
    at runTests (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/program.js:188:18)
    at i.<anonymous> (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/program.js:64:7)
🛑 Stopping server due to setup failure...
🧹 Starting E2E global teardown...
🗑️ Cleaning up test data for run: e2e-1758222241682
⚠️ Failed to clean assignments: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - → GET http://localhost:3120/api/assignments[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

⚠️ Failed to clean scenario assignments: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - → GET http://localhost:3120/api/scenario-assignments[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

⚠️ Failed to clean projects: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - → GET http://localhost:3120/api/projects[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

⚠️ Failed to clean people: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - → GET http://localhost:3120/api/people[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

⚠️ Failed to clean scenarios: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - → GET http://localhost:3120/api/scenarios[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

🗄️ Cleaning up E2E database...
🧹 Cleaning up E2E database...
✅ E2E database cleaned up
✅ E2E global teardown completed successfully
{
  "config": {
    "configFile": "/home/tony/GitHub/Capacinator/playwright.config.ts",
    "rootDir": "/home/tony/GitHub/Capacinator/tests/e2e",
    "forbidOnly": false,
    "fullyParallel": false,
    "globalSetup": "/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts",
    "globalTeardown": "/home/tony/GitHub/Capacinator/tests/e2e/helpers/global-teardown.ts",
    "globalTimeout": 0,
    "grep": {},
    "grepInvert": null,
    "maxFailures": 0,
    "metadata": {},
    "preserveOutput": "always",
    "reporter": [
      [
        "json"
      ]
    ],
    "reportSlowTests": {
      "max": 5,
      "threshold": 300000
    },
    "quiet": false,
    "projects": [
      {
        "outputDir": "/home/tony/GitHub/Capacinator/test-results",
        "repeatEach": 1,
        "retries": 1,
        "metadata": {},
        "id": "smoke",
        "name": "smoke",
        "testDir": "/home/tony/GitHub/Capacinator/tests/e2e",
        "testIgnore": [
          "**/archived/**/*.spec.ts"
        ],
        "testMatch": [
          "/.*smoke.*\\.spec\\.ts$/"
        ],
        "timeout": 60000
      },
      {
        "outputDir": "/home/tony/GitHub/Capacinator/test-results",
        "repeatEach": 1,
        "retries": 1,
        "metadata": {},
        "id": "chromium",
        "name": "chromium",
        "testDir": "/home/tony/GitHub/Capacinator/tests/e2e",
        "testIgnore": [
          "/.*smoke.*\\.spec\\.ts$/",
          "/.*slow.*\\.spec\\.ts$/"
        ],
        "testMatch": [
          "**/*.@(spec|test).?(c|m)[jt]s?(x)"
        ],
        "timeout": 60000
      },
      {
        "outputDir": "/home/tony/GitHub/Capacinator/test-results",
        "repeatEach": 1,
        "retries": 1,
        "metadata": {},
        "id": "firefox",
        "name": "firefox",
        "testDir": "/home/tony/GitHub/Capacinator/tests/e2e",
        "testIgnore": [
          "**/archived/**/*.spec.ts"
        ],
        "testMatch": [
          "/.*@cross-browser.*\\.spec\\.ts$/"
        ],
        "timeout": 60000
      },
      {
        "outputDir": "/home/tony/GitHub/Capacinator/test-results",
        "repeatEach": 1,
        "retries": 1,
        "metadata": {},
        "id": "mobile",
        "name": "mobile",
        "testDir": "/home/tony/GitHub/Capacinator/tests/e2e",
        "testIgnore": [
          "**/archived/**/*.spec.ts"
        ],
        "testMatch": [
          "/.*mobile.*\\.spec\\.ts$/"
        ],
        "timeout": 60000
      },
      {
        "outputDir": "/home/tony/GitHub/Capacinator/test-results",
        "repeatEach": 1,
        "retries": 1,
        "metadata": {},
        "id": "api",
        "name": "api",
        "testDir": "/home/tony/GitHub/Capacinator/tests/e2e",
        "testIgnore": [
          "**/archived/**/*.spec.ts"
        ],
        "testMatch": [
          "/.*api.*\\.spec\\.ts$/"
        ],
        "timeout": 60000
      },
      {
        "outputDir": "/home/tony/GitHub/Capacinator/test-results",
        "repeatEach": 1,
        "retries": 1,
        "metadata": {},
        "id": "scenarios",
        "name": "scenarios",
        "testDir": "/home/tony/GitHub/Capacinator/tests/e2e",
        "testIgnore": [
          "**/archived/**/*.spec.ts"
        ],
        "testMatch": [
          "/.*scenario.*\\.spec\\.ts$/"
        ],
        "timeout": 120000
      }
    ],
    "shard": null,
    "updateSnapshots": "missing",
    "updateSourceMethod": "patch",
    "version": "1.55.0",
    "workers": 4,
    "webServer": null
  },
  "suites": [],
  "errors": [
    {
      "message": "Error: Server failed to start within 60 seconds",
      "stack": "Error: Server failed to start within 60 seconds\n    at waitForServer (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:195:9)\n    at globalSetup (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:34:7)",
      "location": {
        "file": "/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts",
        "column": 9,
        "line": 195
      },
      "snippet": "\u001b[90m   at \u001b[39mhelpers/e2e-global-setup.ts:195\n\n  193 |   }\n  194 |   \n> 195 |   throw new Error(`Server failed to start within ${maxSeconds} seconds`);\n      |         ^\n  196 | }\n  197 |\n  198 | async function waitForApplication(page: Page, baseURL: string) {"
    }
  ],
  "stats": {
    "startTime": "2025-09-18T19:04:01.635Z",
    "duration": 61137.355,
    "expected": 0,
    "skipped": 0,
    "unexpected": 0,
    "flaky": 0
  }
}
