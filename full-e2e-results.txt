
> capacinator@1.0.0 test:e2e
> playwright test --workers=2 --reporter=line

üöÄ Starting E2E global setup...
üóÑÔ∏è Initializing E2E database...
üß™ Initializing E2E test database...
üîß Running E2E database migrations...
Creating baseline database schema...
‚úÖ Baseline database schema created successfully
Fixing primary role foreign key constraint...
‚úÖ Fixed primary role foreign key constraint
Creating missing database views...
‚úÖ Created missing database views
Adding person_utilization_view and project_demands_view...
‚úÖ Added person_utilization_view and project_demands_view
Fixing project_demands_view with correct join conditions...
‚úÖ Fixed project_demands_view with correct join conditions
Fixing database views...
‚úÖ Fixed database views
Adding project_health_view for gaps analysis...
‚úÖ Added project_health_view for gaps analysis
Fixing project_health_view with correct health_status column...
‚úÖ Fixed project_health_view with correct health_status column
Improving project_demands_view with hour calculations...
‚úÖ Improved project_demands_view with hour calculations and project type info
Fixing project_demands_view missing columns...
‚úÖ Fixed project_demands_view with missing phase_id and renamed estimated_hours to demand_hours
Creating project_phase_dependencies table...
‚úÖ Created project_phase_dependencies table with constraints and indexes
üîß Fixing missing IDs in database records...
Found 0 assignments without IDs
Found 0 availability overrides without IDs
‚úÖ Fixed missing IDs
üå± Seeding E2E test data...
üå± Seeding E2E test data...
‚úÖ E2E test data seeded successfully
‚úÖ E2E database initialized successfully
‚úÖ Development server already running
‚è≥ Waiting for application to be ready...
‚è≥ Attempt 1/30 failed, retrying in 1s...
‚è≥ Attempt 2/30 failed, retrying in 1s...
‚è≥ Attempt 3/30 failed, retrying in 1s...
‚è≥ Attempt 4/30 failed, retrying in 1s...
‚è≥ Attempt 5/30 failed, retrying in 1s...
‚è≥ Attempt 6/30 failed, retrying in 1s...
‚è≥ Attempt 7/30 failed, retrying in 1s...
‚è≥ Attempt 8/30 failed, retrying in 1s...
‚è≥ Attempt 9/30 failed, retrying in 1s...
‚è≥ Attempt 10/30 failed, retrying in 1s...
‚è≥ Attempt 11/30 failed, retrying in 1s...
‚è≥ Attempt 12/30 failed, retrying in 1s...
‚è≥ Attempt 13/30 failed, retrying in 1s...
‚è≥ Attempt 14/30 failed, retrying in 1s...
‚è≥ Attempt 15/30 failed, retrying in 1s...
‚è≥ Attempt 16/30 failed, retrying in 1s...
‚è≥ Attempt 17/30 failed, retrying in 1s...
‚è≥ Attempt 18/30 failed, retrying in 1s...
‚è≥ Attempt 19/30 failed, retrying in 1s...
‚è≥ Attempt 20/30 failed, retrying in 1s...
‚è≥ Attempt 21/30 failed, retrying in 1s...
‚è≥ Attempt 22/30 failed, retrying in 1s...
‚è≥ Attempt 23/30 failed, retrying in 1s...
‚è≥ Attempt 24/30 failed, retrying in 1s...
‚è≥ Attempt 25/30 failed, retrying in 1s...
‚è≥ Attempt 26/30 failed, retrying in 1s...
‚è≥ Attempt 27/30 failed, retrying in 1s...
‚è≥ Attempt 28/30 failed, retrying in 1s...
‚è≥ Attempt 29/30 failed, retrying in 1s...
‚ùå E2E global setup failed: Error: Application failed to start after 30 attempts: Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:3120/
Call log:
[2m  - navigating to "http://localhost:3120/", waiting until "domcontentloaded"[22m

    at waitForApplication (file:///home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:264:15)
    at globalSetup (file:///home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:61:5)
    at Object.setup (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/tasks.js:173:27)
    at taskLoop (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:62:11)
    at TaskRunner.runDeferCleanup (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:78:5)
    at TaskRunner.run (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:42:33)
    at runTasks (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/tasks.js:79:18)
    at runAllTestsWithConfig (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/testRunner.js:392:18)
    at runTests (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/program.js:188:18)
    at i.<anonymous> (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/program.js:64:7)
Error: Application failed to start after 30 attempts: Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:3120/
Call log:
[2m  - navigating to "http://localhost:3120/", waiting until "domcontentloaded"[22m


   at helpers/e2e-global-setup.ts:264

  262 |       attempts++;
  263 |       if (attempts >= maxAttempts) {
> 264 |         throw new Error(`Application failed to start after ${maxAttempts} attempts: ${error}`);
      |               ^
  265 |       }
  266 |       console.log(`‚è≥ Attempt ${attempts}/${maxAttempts} failed, retrying in 1s...`);
  267 |       await page.waitForTimeout(1000);
    at waitForApplication (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:264:15)
    at globalSetup (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:61:5)

üßπ Starting E2E global teardown...
üóëÔ∏è Cleaning up test data for run: e2e-1758224959736
‚ö†Ô∏è Failed to clean assignments: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - ‚Üí GET http://localhost:3120/api/assignments[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

‚ö†Ô∏è Failed to clean scenario assignments: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - ‚Üí GET http://localhost:3120/api/scenario-assignments[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

‚ö†Ô∏è Failed to clean projects: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - ‚Üí GET http://localhost:3120/api/projects[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

‚ö†Ô∏è Failed to clean people: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - ‚Üí GET http://localhost:3120/api/people[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

‚ö†Ô∏è Failed to clean scenarios: apiRequestContext.get: connect ECONNREFUSED 127.0.0.1:3120
Call log:
[2m  - ‚Üí GET http://localhost:3120/api/scenarios[22m
[2m    - user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/140.0.7339.16 Safari/537.36[22m
[2m    - accept: */*[22m
[2m    - accept-encoding: gzip,deflate,br[22m

üóÑÔ∏è Cleaning up E2E database...
üßπ Cleaning up E2E database...
‚úÖ E2E database cleaned up
‚úÖ E2E global teardown completed successfully
[1A[2K