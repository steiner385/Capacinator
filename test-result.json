ğŸš€ Starting E2E global setup...
ğŸ—„ï¸ Initializing E2E database...
ğŸ§ª Initializing E2E test database...
ğŸ—‘ï¸ Removed existing E2E database file
ğŸ”§ Running E2E database migrations...
Creating baseline database schema...
âœ… Baseline database schema created successfully
Fixing primary role foreign key constraint...
âœ… Fixed primary role foreign key constraint
Creating missing database views...
âœ… Created missing database views
Adding person_utilization_view and project_demands_view...
âœ… Added person_utilization_view and project_demands_view
Fixing project_demands_view with correct join conditions...
âœ… Fixed project_demands_view with correct join conditions
Fixing database views...
âœ… Fixed database views
Adding project_health_view for gaps analysis...
âœ… Added project_health_view for gaps analysis
Fixing project_health_view with correct health_status column...
âœ… Fixed project_health_view with correct health_status column
Creating settings table...
âœ… Created settings table with default import settings
ğŸ”§ Fixing assignments with null dates...
Found 0 phase-based assignments with null dates
Found 0 project-based assignments with null dates
Found 0 assignments still with null dates
âœ… Assignment dates fixed
Improving project_demands_view with hour calculations...
âœ… Improved project_demands_view with hour calculations and project type info
Fixing project_demands_view missing columns...
âœ… Fixed project_demands_view with missing phase_id and renamed estimated_hours to demand_hours
Creating project_phase_dependencies table...
âœ… Created project_phase_dependencies table with constraints and indexes
ğŸ”§ Fixing missing IDs in database records...
Found 0 assignments without IDs
Found 0 availability overrides without IDs
âœ… Fixed missing IDs
Creating person_availability_view...
âœ… Created person_availability_view
Fixing person_utilization_view to use scenario assignments...
âœ… Fixed person_utilization_view to use scenario assignments
Fixing project_demands_view to use actual assignments...
âœ… Fixed project_demands_view to use scenario assignments
ğŸŒ± Seeding E2E test data...
ğŸŒ± Seeding consolidated E2E test data...
Existing people before clear: 
People count after clear: 0
âœ… Consolidated E2E test data seeded successfully
ğŸ“Š Utilization scenarios created:
   - E2E Over Utilized: 120% (80% + 40%)
   - E2E Normal Utilized: 80%
   - E2E Under Utilized: 40%
   - E2E Zero Utilized: 0%
âœ… E2E database initialized successfully
âœ… E2E database initialized successfully
â„¹ï¸ Development server already running on ports 3110/3120
   E2E tests will use the existing server and database.
   For isolated testing, stop the dev server first.
â³ Waiting for application to be ready...
âœ… Application is ready
ğŸ” Verifying test data...
âœ… API health check passed
âœ… /api/roles: 13 items
ğŸ” Handling initial profile selection...
ğŸ“‹ Profile selection modal detected
ğŸ¯ Starting profile selection...

ğŸ“ Attempt 1/3 to select profile...
Select trigger text: "Select your name..."
ğŸ“‚ Opening profile dropdown...
ğŸ” Trying strategy: Standard role="option"
âœ… Standard role="option": Found 8 options
DOM state: 0 portals, 0 popper wrappers
Available profiles: []
Selecting profile: "undefined"
âŒ Attempt 1 failed: locator.click: Timeout 30000ms exceeded.
Call log:
[2m  - waiting for locator('[role="option"]:visible').first()[22m

    at selectProfile (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:471:43)
    at handleInitialProfileSelection (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:342:7)
    at globalSetup (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:78:5) {
  name: 'TimeoutError'
}
ğŸ”„ Retrying...

ğŸ“ Attempt 2/3 to select profile...
Select trigger text: "Select your name..."
ğŸ“‚ Opening profile dropdown...
ğŸ” Trying strategy: Standard role="option"
âš ï¸ Standard role="option": No visible options
ğŸ” Trying strategy: Radix collection items
âš ï¸ Radix collection items: No visible options
ğŸ” Trying strategy: Portal with role="option"
âš ï¸ Portal with role="option": No visible options
ğŸ” Trying strategy: Any SelectItem in portal
âš ï¸ Any SelectItem in portal: No visible options
ğŸ” Trying strategy: Direct SelectContent children
âš ï¸ Direct SelectContent children: No visible options
ğŸ¹ Trying keyboard navigation...
ğŸ“Š After keyboard activation: 0 options
DOM state: 0 portals, 0 popper wrappers
âŒ Attempt 2 failed: Error: No profile options found on attempt 2
    at selectProfile (file:///home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:516:15)
    at handleInitialProfileSelection (file:///home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:342:7)
    at globalSetup (file:///home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:78:5)
    at Object.setup (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/tasks.js:173:27)
    at taskLoop (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:62:11)
    at TaskRunner.runDeferCleanup (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:78:5)
    at TaskRunner.run (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/taskRunner.js:42:33)
    at runTasks (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/tasks.js:79:18)
    at runAllTestsWithConfig (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/runner/testRunner.js:392:18)
    at runTests (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/program.js:188:18)
    at i.<anonymous> (/home/tony/GitHub/Capacinator/node_modules/playwright/lib/program.js:64:7)
ğŸ”„ Retrying...

ğŸ“ Attempt 3/3 to select profile...
Select trigger text: "Select your name..."
ğŸ“‚ Opening profile dropdown...
ğŸ” Trying strategy: Standard role="option"
âœ… Standard role="option": Found 8 options
DOM state: 0 portals, 0 popper wrappers
Available profiles: []
Selecting profile: "undefined"
âŒ Attempt 3 failed: locator.click: Timeout 30000ms exceeded.
Call log:
[2m  - waiting for locator('[role="option"]:visible').first()[22m

    at selectProfile (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:471:43)
    at handleInitialProfileSelection (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:342:7)
    at globalSetup (/home/tony/GitHub/Capacinator/tests/e2e/helpers/e2e-global-setup.ts:78:5) {
  name: 'TimeoutError'
}
ğŸ”Œ All UI attempts failed, trying API fallback...
ğŸ”Œ Using API fallback for profile selection...
API fallback: Selecting Alice Johnson
âœ… Profile selected via API fallback
âœ… Profile selected and saved
ğŸ’¾ Current auth data: { hasCurrentUser: true, hasSelectedProfile: true }
ğŸ’¾ Authentication state saved to /home/tony/GitHub/Capacinator/test-results/e2e-auth.json
âœ… Saved state verification: Contains localStorage data
âœ… E2E global setup completed successfully
